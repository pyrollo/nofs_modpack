# Classes
## Form
A form instance that is displayed to a player. Form definition gives the
direction of how should the form look like. Then data context (player, maybe
node or other stuff) will influence what is exactly instantiated. Form instance
issues events that can be handled by specific callbacks.
This is the main entry point of NoFS (using **nofs.new_form**)
## Item
An instance of an item in the form. Mostly generated by a Form object, can be
generated by some widgets (scrollbars for example). Should not be created
outside NoFS.
# Concepts
## Form definition
**Form definition** is a table describing the form that should be displayed.
Internally, NoFS creates Item instances according to that form definition plus
the data sources (some items in the definition may be repeated in the instance
if they are connected to multiple data).
## Context
**Context** is somewhere internal data are stored for technic and persistance
purpose.
## Data
To be defined. Probably, data will be linked to items by item contexts.
## Widget
**Widget** are actually widget types. Each form item has a widget type
(including the form itself that has implicitly the "form" widget type).

# Widget registering

## Widget definition
### Fields
All fields are optional.
  * `width`: Default widget width
  * `height`: Default widget height
  * `is_root`: `true` if this widget can be a form root (default `false`)
  * `parent_type`: If set, ensure that the parent widget is of this type.
  * `children_type`: If set, ensure that all child widgets are of this type.
  * `layout`: For some containers, defines how children are laid out.
  * `overlapping`: If `true`, indicates that the widgets overlaps other items. For example for "tab" widgets (Default : `false`).

### Callbacks
`init(item)`: Called after Item instance creation to perform initialization
tasks.

`handle_field_event(item, fieldvalue, fieldname)`: Called when field received
for this widget. `item` is the reference to the item instance, `fieldvalue` is
the received field value, `fieldname` is the name of the field (usualy
corresponding to item id).

`render(item)`: Should return the formspec string corresponding to `item`
instance

`lay_out(item)`: Place children (if any) and sizes the element.
`save(item)`: Called when Form:save() called. Should perform save operations.

# Widget catalogue
## Common attributes
  * `type`: Type of the item. This field is required and must correspond to a registerd widget.
  * `id`: Item identifier. Must be unique in form, can be used to reference this item. Items with no ids are given one automatically.
  * `width`: Item width (ignored for container widgets)
  * `height`: Item height (ignored for container widgets). As a helper, standard field height is given by `nofs.fs_field_height`.

## Common triggers
  * `init`: called when item instance is created. A good place to do some initialization stuff like setting the value of a field.
  * `save`: Called when value have to be saved (when `Form:save` called).

# Container widgets
## form
The form itself. Must be the root element for each form.
  * `margin`: Margin around content (default 0)
  * `layout`: Defines how children are laid out. Can be "vertical" or "horizontal" (default "vertical").

## vbox and hbox
Containers holding vertically or horizontally stacked children.
  * `spacing` (inherits): Spacing between child elements.
  * `valign`: Vertical alignment ("top", "middle", "bottom". Default "middle").
  * `halign`: Horizontal alignment ("left", "center", "right". Default "center").
  * `max_items`: Maximum displayed children. Extra children are not displayed.
  * `overflow`: If more children than `max_items`, indicates what to do. For now, the only choice is "scrollbar" (default:`nil`).

## tab
A tab page in a form (not allowed in other items).
  * `label`: Tab page label.
  * `layout`: Defines how children are laid out. Can be "vertical" or "horizontal" (default "vertical").
  * `spacing` (inherits): Spacing between child elements (default 0).
  * `valign`: Vertical alignment ("top", "middle", "bottom". Default "middle").
  * `halign`: Horizontal alignment ("left", "center", "right". Default "center").
  * `max_items`: Maximum displayed children. Extra children are not displayed (default `nil`).
  * `overflow`: If more children than `max_items`, indicates what to do. For now, the only choice is "scrollbar" (default: `nil`).

# Basic widgets
## label
### Attributes
  * `label` (contextual): Text displayed

## button
### Attributes
  * `label`: Label displayed on the button
  * `exit`: If `true`, button will quit form (default `false`).
  * `image`: Image displayed on the button
  * `item`: Item displayed on the button
A button can't have both `image` and `item` attributes. In such case `item` attribute is ignored.
### Triggers
  * `on_clicked`: Function called when the button is clicked.

## field
### Attributes
  * `label` (contextual): Field label
  * `value` (contextual): Default value
  * `meta`: Field connected to metadata (player or node).
  * `hidden`: Hidden (password) field if set to `true` (default `false`).
### Triggers
  * `on_changed`: Function called when the field value has been changed. This is not immediate but called as soon as another event happens (button click, form close...) and before this event trigger.

## textarea
### Attributes
  * `meta`: Textarea connected to metadata (player or node).
  * `label` (contextual): Textarea label
  * `value` (contextual): Default value
### Triggers
  * `on_changed`: Function called when the textarea value has been changed. This is not immediate but called as soon as another event happens (button click, form close...) and before this event trigger.

## checkbox
### Attributes
  * `meta`: Checkbox connected to metadata (player or node).
  * `label`: Checkbox label
  * `value` (contextual): Default value (boolean)
### Triggers
  * `on_clicked`: Function called when the checkbox is clicked.
  * `on_changed`: Function called when the checkbox value has been changed. This is not immediate but called as soon as another event happens (button click, form close...) and before this event trigger.

## inventory
### Attributes
  * `location`: Inventory location
  * `list`: Inventory list name

## scrollbar
### Attributes
  * `connected_to`: Item id to connect to. Item should be responsive to scrollbar demands (hbox/vbox)
  * `orientation` (default "vertical")
### Triggers
None yet.

# Form triggers
## on_close
Sources: **form**

# Connection of items to metadata
TODO

# WIP
| Formspec element | nofs widget | Status |
| --- | --- | --- |
| size[W,H] | Form level | Done |
| position[X,Y] | Form level | Not started |
| anchor[X,Y] | Form level | Not started |
| no_prepend[] | Form level | Not started |
| container[X,Y] | | Useless |
| container_end[] | | Useless |
| list[invloc;listname;X,Y;W,H;] | inventory | Done |
| list[invloc;listname;X,Y;W,H;index] | inventory | Not started |
| listring[invloc;listname] | inventory | Done |
| listring[] | ? | Not started |
| listcolors[bgcolor;bgcolorhover] | ? | Not started |
| listcolors[bgcolor;bgcolorhover;border] | ? | Not started |
| listcolors[bgcolor;bgcolorhover;border;tooltip_bg;tooltip_fontcolor] | ? | Not started |
| tooltip[id;text;bgcolor;fontcolor] | ? | Not started |
| tooltip[X,Y;W,H;text;bgcolor;fontcolor] | ? | Not started |
| image[X,Y;W,H;texture] | ? | Not started |
| item_image[X,Y;W,H;itemname] | ? | Not started |
| bgcolor[color;fullscreen] | Form level | Not started |
| background[X,Y;W,H;texture] | Form level | Not started |
| background[X,Y;W,H;texture;auto_clip] | Form level | Not started |
| pwdfield[X,Y;W,H;name;label] | field | Done |
| field[X,Y;W,H;name;label;default] | field | Done |
| field[name;label;default] | field | Done |
| field_close_on_enter[name;close_on_enter] | field | Not started |
| textarea[X,Y;W,H;name;label;default] | ? | Not started |
| label[X,Y;label] | label | Done |
| vertlabel[X,Y;label] | label | Done |
| button[X,Y;W,H;name;label] | button | Done |
| image_button[X,Y;W,H;image;name;label] | button | Done |
| image_button[X,Y;W,H;image;name;label;noclip;drawborder;pressedimage] | button | Not started |
| item_image_button[X,Y;W,H;item name;name;label] | button | Done |
| button_exit[X,Y;W,H;name;label] | button | Done |
| image_button_exit[X,Y;W,H;image;name;label] | button | Done |
| textlist[X,Y;W,H;name;listelem 1,listelem 2,...,listelem n] | ? | Not started |
| tabheader[X,Y;name;caption 1,caption 2,...,caption n;current_tab;transparent;draw_border] | ? | Not started |
| textlist[X,Y;W,H;name;listelem 1,listelem 2,...,listelem n;selected idx;transparent] | ? | Not started |
| box[X,Y;W,H;color] | vbox/hbox | Not started |
| checkbox[X,Y;label] | checkbox | Done |
| dropdown[X,Y;W;name;item 1,item 2, ...,item n;selected idx] | ? | Not started |
| scrollbar[X,Y;W,H;orientation;name;value] | ? | Not started |
| table[X,Y;W,H;name;cell 1,cell 2,...,cell n;selected idx] | ? | Not started |
| tablecolumns[type 1,opt 1a,opt 1b,...;type 2,opt 2a,opt 2b;...] | ? Not started |


# Context fields
(Context field usage)
## Multi-instance container
**start_index**: Starting index of displayed items.
**max_index**: Maximum index of displayed items.
**max_items**: (in def for now) Maximum number of displayed items.
## Pager
**current_page**: Current displayed page
